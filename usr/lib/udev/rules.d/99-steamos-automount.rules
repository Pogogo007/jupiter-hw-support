# Originally from https://serverfault.com/a/767079
# Run a mount script through systemd on any mmcblk* and sd* activity

#If device is not sda or sdcard, ignore.
KERNEL!="mmcblk*|sd*",          GOTO="steamos_automount_end"
#If sda device is not usb, ignore.
KERNEL=="sd*", ENV{ID_BUS}!="usb", GOTO="steamos_automount_end"
#Do not automount crypto, raid or other special devices
ENV{ID_FS_USAGE}!="filesystem", GOTO="steamos_automount_end"

# The service expects to be asynchronous and shouldn't block udev rules
ACTION=="add",    RUN+="/bin/systemd-run --no-block --collect /usr/lib/hwsupport/block-device-event.sh add %k"
ACTION=="remove", RUN+="/bin/systemd-run --no-block --collect /usr/lib/hwsupport/block-device-event.sh remove %k"

LABEL="steamos_automount_end"
